<html>
  <head>
    <title>Migration Map</title>
    <meta charset="utf-8">
    <style media="screen">
      html, body {
        margin: 0;
        padding: 0;
        width: 620px;
        height: 620px;
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        position: relative;
      }
      h1 {
        font-size: 24px;
        font-style: normal;
        font-variant: normal;
        font-weight: 500;
        color: #29ae9a;
      }
      a {
        color: #ff6166;
      }
      #image {
        width: 100%;
        height: 100%;
      }
      .clicktarget {
        position: absolute;
        cursor: pointer;
        width: 60px;
        height: 25px;
      }
      #portugal {
        left: 47px;
        top: 449px;
      }
      #spain {
        left: 160px;
        top: 480px;
      }
      #italy {
        left: 344px;
        top: 427px;
      }
      #greece {
        left: 497px;
        top: 541px;
      }
      #volume {
        position: absolute;
        cursor: pointer;
        background: url(images/volume.png);
        width: 30px;
        height: 30px;
        top: 10px;
        right: 10px;
      }
      #volume.on {
        background-position: 0 0;
      }
      #volume.off {
        background-position: 0 30px;
      }
      #info {
        position: absolute;
        bottom: 15px;
        left: 50px;
      }
      #modal {
        display: none;
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }
      #backdrop {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: rgba(0, 0, 0, 0.5);
      }
      #close {
        position: absolute;
        cursor: pointer;
        font-size: 20px;
        line-height: 20px;
        color: #999;
        right: 10px;
        top: 10px;
        font-weight: 500;
      }
      .info-box {
        background: white;
        position: absolute;
        bottom: 10px;
        left: 10px;
        right: 10px;
        padding: 20px;
        z-index: 1;
      }
    </style>
  </head>

  <body>
    <img id="image" src="images/00_Karte_Plain.jpg" alt="Europa"/>
    <div class="clicktarget" id="portugal"></div>
    <div class="clicktarget" id="greece"></div>
    <div class="clicktarget" id="spain"></div>
    <div class="clicktarget" id="italy"></div>
    <div id="volume"></div>

    <audio id="portugal-audio">
      <source src="audio/portugal.ogg" type="audio/ogg" />
      <source src="audio/portugal.mp3" type="audio/mpeg" />
    </audio>

    <audio id="greece-audio">
      <source src="audio/greece.ogg" type="audio/ogg" />
      <source src="audio/greece.mp3" type="audio/mpeg" />
    </audio>

    <audio id="spain-audio">
      <source src="audio/spain.ogg" type="audio/ogg" />
      <source src="audio/spain.mp3" type="audio/mpeg" />
    </audio>

    <audio id="italy-audio">
      <source src="audio/italy.ogg" type="audio/ogg" />
      <source src="audio/italy.mp3" type="audio/mpeg" />
    </audio>

    <a href="#info-box" id="info">Informationen zur Karte</a>

    <div id="modal">
      <div class="info-box">

        <h1>Generation E – von Süd nach Nord</h1>

        <p>
          Die Pfeile repräsentieren die Wanderungsbewegungen der südeuropäischen
          Migranten der vergangenen Jahre. Je dicker der Pfeil, desto mehr
          Migranten.
        </p>

        <p>
          Die Daten sind nicht repräsentativ, sondern wurden über den Fragebogen
          des Projektes Generation E gesammelt. Helfen Sie uns, mehr Daten und
          Geschichten zu sammeln unter <a target="_blank" href="http://generatione.eu">generatione.eu</a>.
        </p>

        <p>
          <b>Illustration:</b> Nick Böse
        </p>

        <p>
          <b>Umsetzung der Karte:</b> Stefan Wehrmeyer / Simon Jockers,
          <a target="_blank" href="http://correctiv.org">CORRECT!V</a>
        </p>

        <a target="_blank" href="http://www.correctiv.org/impressum/">Impressum</a>

        <div id="close">X</div>
      </div>
      <div id="backdrop"></div>
    </div>

    <script charset="utf-8">
      var soundOn = document.location.search.indexOf('nosound') == -1;
      var currentCountry = null;

      var background = document.getElementById('image');
      var volumeToggle = document.getElementById('volume');
      var infoButton = document.getElementById('info');
      var modal = document.getElementById('modal');
      var backdrop = document.getElementById('backdrop');
      var close = document.getElementById('close');

      updateVolumeToggle(soundOn);

      close.onclick = hideModal;
      backdrop.onclick = hideModal;

      infoButton.onclick = function(event) {
        event.preventDefault();
        showModal()
      }

      volumeToggle.onclick = function() {
        soundOn = !soundOn;
        updateVolumeToggle(soundOn);
      }

      function setupClickTarget(elementId, image) {
        background.onclick = null;
        var country = document.getElementById(elementId);
        country.style.display = 'block';

        country.onmouseover = function() {
          background.src = 'images/' + image + '_Mouseover.jpg';
        }

        country.onmouseout = function() {
          background.src = 'images/00_Karte_Plain.jpg';
        }

        country.onclick = function() {
          if (currentCountry === null) {
            currentCountry = country;
            country.onmouseout = null;
            country.onmouseover = null;
            background.src = 'images/' + image + '_Click.jpg';
            background.onclick = country.onclick;
            showClickTarget(country)

            if (soundOn) {
              playAudio(elementId);
            }
          } else {
            currentCountry = null;
            background.src = 'images/00_Karte_Plain.jpg';
            setupClickTarget('portugal', '01_Portogal');
            setupClickTarget('greece', '04_Griechenland');
            setupClickTarget('spain', '02_Spanien');
            setupClickTarget('italy', '03_Italien');
            stopAudio()
          }
        }
      }

      function showClickTarget(country) {
        hideClickTargets();
        country.style.display = 'block';
      }

      function hideClickTargets() {
        var countries = document.getElementsByClassName('clicktarget');
        for (var i = 0; i < countries.length; i++) {
          countries[i].style.display = 'none';
        }
      }

      function stopAudio() {
        var audios = document.getElementsByTagName('audio');
        for (var i = 0; i < audios.length; i++) {
          audios[i].pause();
        }
      }

      function playAudio(fileId) {
        var audio = document.getElementById(fileId + '-audio');
        audio.volume = 0.5;
        audio.currentTime = 0;
        audio.play();
      }

      function updateVolumeToggle(volumeIsOn) {
        volumeToggle.className = volumeIsOn ? 'on' : 'off'
      }

      function hideModal() {
        modal.style.display = 'none';
      }

      function showModal() {
        modal.style.display = 'block';
      }

      setupClickTarget('portugal', '01_Portogal');
      setupClickTarget('greece', '04_Griechenland');
      setupClickTarget('spain', '02_Spanien');
      setupClickTarget('italy', '03_Italien');

    </script>
  </body>
</html>
